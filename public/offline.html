<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your offline</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        color: #333333;
        text-align: center;
        margin: 0;
      }
      /*Todo check box styles*/

      .todo_container {
        padding: 10px;
      }
      .todolist {
        list-style-type: none;
        display: flex;
        flex-direction: column;
        gap: 3px;
      }
      .todoiteminput {
        border: none;
        padding: 10px;
        border-radius: 5px;
        background: #0000004d;
        color: #fff;
        width: 100%;
        margin: 1em;
      }

      .todolist li {
        display: flex;
        flex-direction: row;
        gap: 10px;
        align-items: center;
        min-height: 25px;
      }

      .todolist li span {
        padding: 10px;
        border: 1px solid transparent;
        outline: none;
      }

      .todolist li span:focus-within {
        color: #e4e4e4;
        border: 1px solid #353535;
        border-radius: 5px;
      }

      /* Hide the default checkbox */
      .todocontainer input {
        display: none;
      }

      .todocontainer {
        display: block;
        position: relative;
        cursor: pointer;
        font-size: 20px;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      /* Create a custom checkbox */
      .todocheckmark {
        position: relative;
        top: 0;
        left: 0;
        height: 1.3em;
        width: 1.3em;
        background-color: #2196f300;
        border-radius: 0.25em;
        transition: all 0.25s;
      }

      /* When the checkbox is checked, add a blue background */
      .todocontainer input:checked ~ .todocheckmark {
        /*background-color: #2196F3;*/
      }

      /* Create the checkmark/indicator (hidden when not checked) */
      .todocheckmark:after {
        content: "";
        position: absolute;
        transform: rotate(0deg);
        border: 0.1em solid black;
        left: 0;
        top: 0;
        width: 1.05em;
        height: 1.05em;
        border-radius: 0.25em;
        transition: all 0.25s, border-width 0.1s;
      }

      /* Show the checkmark when checked */
      .todocontainer input:checked ~ .todocheckmark:after {
        left: 0.45em;
        top: 0.25em;
        width: 0.25em;
        height: 0.5em;
        border-color: #fff0 rgb(0, rgb(0, 0, 0)) white #fff0;
        border-width: 0 0.15em 0.15em 0;
        border-radius: 0em;
        transform: rotate(45deg);
      }

      .tododeletebtn {
        border: none;
        color: #a9a9a9;
        border-radius: 3px;
        cursor: pointer;
        font-weight: 600;
        font-size: 12px;
        background: none;
      }

      .tododeletebtn svg {
        fill: #353535;
        transition: 0.2s;
      }
      .tododeletebtn:hover svg {
        fill: #ff5555;
      }

      .tododeletebtn svg path {
        stroke: none !important;
      }

      /*!!END!! todo checkbox styles*/
    </style>
  </head>
  <body>
    <script src="/offline/editor"></script>
    <script src="/offline/table"></script>
    <script src="/offline/quote"></script>
    <script src="/offline/list"></script>
    <script src="/offline/header"></script>

    <div style="padding: 40px;">
    <h1>Oops! You're offline</h1>
    <p>
      Sorry, it looks like you are currently offline. Please check your internet
      connection and try again. Offline support is currently in devlopment.
      <br/><br/>Not all features are supported as they require network connection. This is still beta so it may not work as expected
    </p>
    </div>

    <script>
        class SimpleTodo {
    static get toolbox() {
      return {
        title: "Todo",
        icon: '<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24px" viewBox="0 0 24 24" width="24px"><rect fill="none" height="24" width="24"/><g><path d="M22,8c0-0.55-0.45-1-1-1h-7c-0.55,0-1,0.45-1,1s0.45,1,1,1h7C21.55,9,22,8.55,22,8z M13,16c0,0.55,0.45,1,1,1h7 c0.55,0,1-0.45,1-1c0-0.55-0.45-1-1-1h-7C13.45,15,13,15.45,13,16z M10.47,4.63c0.39,0.39,0.39,1.02,0,1.41l-4.23,4.25 c-0.39,0.39-1.02,0.39-1.42,0L2.7,8.16c-0.39-0.39-0.39-1.02,0-1.41c0.39-0.39,1.02-0.39,1.41,0l1.42,1.42l3.54-3.54 C9.45,4.25,10.09,4.25,10.47,4.63z M10.48,12.64c0.39,0.39,0.39,1.02,0,1.41l-4.23,4.25c-0.39,0.39-1.02,0.39-1.42,0L2.7,16.16 c-0.39-0.39-0.39-1.02,0-1.41s1.02-0.39,1.41,0l1.42,1.42l3.54-3.54C9.45,12.25,10.09,12.25,10.48,12.64L10.48,12.64z"/></g></svg>',
      };
    }
  
    constructor({ data, config }) {
      this.data = data || {
        items: []
      };
      this.wrapper = undefined;
      this.config = config;
    }
  
    render() {
      this.wrapper = document.createElement("div");
      this.wrapper.classList.add("todo_container");
  
      const list = document.createElement("ul");
      list.classList.add("todolist");
  
      if (this.data && this.data.items) {
        this.data.items.forEach((item, index) => {
          const listItem = document.createElement("li");
  
          const label = document.createElement("label");
          label.classList.add("todocontainer");
  
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.checked = item.checked;
  
          const checkmark = document.createElement("div");
          checkmark.classList.add("todocheckmark");
  
          label.appendChild(checkbox);
          label.appendChild(checkmark);
  
          listItem.appendChild(label);
  
          const content = document.createElement("span");
          content.textContent = item.content;
          content.contentEditable = true; // Make the content editable
  
          content.addEventListener("input", () => {
            item.content = content.textContent;
          });
  
          listItem.appendChild(content);
  
          const deleteButton = document.createElement("button");
          deleteButton.classList.add("tododeletebtn")
          deleteButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" ><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>`
          deleteButton.addEventListener("click", () => {
            this.data.items.splice(index, 1);
            listItem.remove();
          });
          checkbox.addEventListener("change", () => {
            item.checked = checkbox.checked;
            if (item.checked) {
              listItem.appendChild(deleteButton);
            } else {
              listItem.removeChild(deleteButton);
            }
  
            this.config.saveData.saveAll()
          });
          if (item.checked) {
            listItem.appendChild(deleteButton);
          }
  
  
          list.appendChild(listItem);
        });
      } else {
        this.data = { items: [] };
      }
  
      const addItemInput = document.createElement("input");
      addItemInput.type = "text";
      addItemInput.placeholder = "+ Add an item";
      addItemInput.classList.add("todoiteminput");
      addItemInput.addEventListener("keydown", (event) => {
        if (event.key === "Enter" && addItemInput.value.trim() !== "") {
          const newItem = {
            content: addItemInput.value.trim(),
            checked: false
          };
          this.data.items.push(newItem);
  
          const listItem = document.createElement("li");
  
          const label = document.createElement("label");
          label.classList.add("todocontainer");
  
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
  
          const checkmark = document.createElement("div");
          checkmark.classList.add("todocheckmark");
  
          label.appendChild(checkbox);
          label.appendChild(checkmark);
  
          listItem.appendChild(label);
  
          const content = document.createElement("span");
          content.textContent = newItem.content;
          content.contentEditable = true; // Make the content editable
  
          content.addEventListener("input", () => {
            newItem.content = content.textContent;
          });
  
          listItem.appendChild(content);
  
  
  
          checkbox.addEventListener("change", () => {
            newItem.checked = checkbox.checked;
  
            this.config.saveData.saveAll()
          });
  
          list.appendChild(listItem);
  
  
          addItemInput.value = "";
        }
      });
  
      this.wrapper.appendChild(list);
      this.wrapper.appendChild(addItemInput);
  
      return this.wrapper;
    }
  
  
    save() {
      return this.data;
    }
  }
    </script>
    <div
      style="text-align: left; padding: 2em; background: #e4e4e4"
      id="editorjs"
    ></div>
    <script>
      if (!localStorage.getItem("Offlinesave")) {
        localStorage.setItem("Offlinesave", null);
      }
      const editor = new EditorJS({
        autofocus: true,
        tools: {
          header: {
            class: Header,
            inlineToolbar: true,
          },
          list: {
            class: List,
            inlineToolbar: true,
          },
          quote: {
            class: Quote,
            inlineToolbar: true,
          },
          table: Table,
          

          todo: {
            class: SimpleTodo,
            config: {
              saveData: {
                saveAll() {
                  async function save() {
                    const data2 = await editor.save();
                    localStorage.setItem("Offlinesave", JSON.stringify(data2));
                    localStorage.setItem('Offlinetime', 'true')
                    console.log(
                      JSON.parse(localStorage.getItem("Offlinesave"))
                    );
                  }
                  return save();
                },
              },
            },
          },
        },
        placeholder: "Enter some text...",
        data: JSON.parse(localStorage.getItem("Offlinesave")),
      });
    </script>
    <script>
      let lastTyped = Date.now();
      let saving = false;
      let timer;

      window.addEventListener("keydown", debounce(typed, 500));

      function typed() {
        lastTyped = Date.now();
        clearTimeout(timer);
        timer = setTimeout(save, 500);
      }

      async function save() {
        saving = true;
        const data2 = await editor.save();
        localStorage.setItem("Offlinesave", JSON.stringify(data2));
        localStorage.setItem('Offlinetime', 'true')
        console.log(JSON.parse(localStorage.getItem("Offlinesave")));
        saving = false;
      }

      function debounce(func, delay) {
        let timeoutId;
        return function (...args) {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => {
            func.apply(this, args);
          }, delay);
        };
      }
    </script>
  </body>
</html>


<!--
    image: {
            class: ImageTool,
            config: {
              uploader: {
                uploadByFile(file) {
                  return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                      const base64Data = reader.result.split(",")[1];
                      const imageData = {
                        success: 1,
                        file: {
                          url: `data:image/jpeg;base64,${base64Data}`,
                        },
                      };
                      resolve(imageData);
                    };
                    reader.onerror = (error) => {
                      reject(error);
                    };
                    reader.readAsDataURL(file);
                  });
                },
              },
            },
          },
-->
